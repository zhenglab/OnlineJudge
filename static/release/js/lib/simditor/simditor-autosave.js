(function(e,t){typeof define=="function"&&define.amd?define("simditor-autosave",["jquery","simple-module","simditor"],function(n,r,i){return e.SimditorAutosave=t(n,r,i)}):typeof exports=="object"?module.exports=t(require("jquery"),require("simple-module"),require("simditor")):e.SimditorAutosave=t(jQuery,SimpleModule,Simditor)})(this,function(e,t,n){var r,i=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},s={}.hasOwnProperty;return r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.pluginName="Autosave",n.prototype.opts={autosave:!0,autosavePath:null},n.prototype._init=function(){var t,n,r,i;this.editor=this._module;if(!this.opts.autosave)return;this.name=typeof this.opts.autosave=="string"?this.opts.autosave:"simditor",this.opts.autosavePath?this.path=this.opts.autosavePath:(n=e("<a/>",{href:location.href}),r=this.editor.textarea.data("autosave")||this.name,this.path="/"+n[0].pathname.replace(/\/$/g,"").replace(/^\//g,"")+"/autosave/"+r+"/");if(!this.path)return;this.editor.on("valuechanged",function(e){return function(){return e.storage.set(e.path,e.editor.getValue())}}(this)),this.editor.el.closest("form").on("ajax:success.simditor-"+this.editor.id,function(e){return function(t){return e.storage.remove(e.path)}}(this)),i=this.storage.get(this.path);if(!i)return;t=this.editor.textarea.val();if(i===t)return;return this.editor.textarea.is("[data-autosave-confirm]")?confirm(this.editor.textarea.data("autosave-confirm")||"Are you sure to restore unsaved changes?")?this.editor.setValue(i):this.storage.remove(this.path):this.editor.setValue(i)},n.prototype.storage={supported:function(){var e;try{return localStorage.setItem("_storageSupported","yes"),localStorage.removeItem("_storageSupported"),!0}catch(t){return e=t,!1}},set:function(e,t,n){var r;n==null&&(n=!1);if(!this.supported())return;return r=n?sessionStorage:localStorage,r.setItem(e,t)},get:function(e,t){var n;t==null&&(t=!1);if(!this.supported())return;return n=t?sessionStorage:localStorage,n[e]},remove:function(e,t){var n;t==null&&(t=!1);if(!this.supported())return;return n=t?sessionStorage:localStorage,n.removeItem(e)}},n}(t),n.connect(r),r});